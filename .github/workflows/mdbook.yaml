name: Build and deploy mdbook

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@main
      - name: Get mdbook
        uses: peaceiris/actions-mdbook@v1
        with:
          mdbook-version: 'latest'
      - name: Build the books and deploy
        run: |
          git config --global --add safe.directory /github/workspace
          for f in exercises/*; do
            cd $f
            mdbook build
            mkdir -p ../../docs/$f
            cp -r book/* ../../docs/$f
            cd ../..
          done
      - name: Commit
        uses: actions-x/commit@v4
        with:
          message: "Build mdbooks"
          files: "docs/exercises/*"
